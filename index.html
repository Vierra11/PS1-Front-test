<!DOCTYPE html>
<html>

<head>
	<title>Seat booking</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link href="css/style.css" rel="stylesheet" type="text/css" media="all" />
	<script src="js/jquery-1.11.0.min.js"></script>
	<script src="js/jquery.seat-charts.js"></script>
	<script src="js/index.js"></script>
</head>

<body>
	<div class="content">
		<h2>Seat Booking</h2>
		<div class="main">
			<div class="demo">
				<div id="seat-map">
					<div class="front">SCREEN</div>
				</div>
				<div class="booking-details">
					<ul class="book-left">
						<li>Movie </li>
						<li>Theatre</li>
						<li>Date </li>
						<li>Time</li>
						<li>Tickets</li>
						<li>Total</li>
						<li>Selected Seats</li>
					</ul>
					<ul class="book-right">
						<li>: <span id="movie_name"></span></li>
						<li>: <span id="theatre_name"></span></li>
						<li>: <span id="date"></span></li>
						<li>: <span id="time"></span></li>
						<li>: <span id="counter">0</span></li>
						<li>: <b><i>RS.</i><span id="total">0</span></b></li>
					</ul>
					<div class="clear"></div>
					<ul id="selected-seats" class="scrollbar scrollbar1"></ul>


					<div id="legend"></div>
				</div>

				<script type="text/javascript">
					var firstSeatLabel = 1;

					function getQueryParams() {
							const params = {};
							window.location.search
								.substr(1)
								.split("&")
								.forEach(function (item) {
									const [key, value] = item.split("=");
									if (key) params[key] = decodeURIComponent(value);
								});
							return params;
						}

						const queryElements = getQueryParams();

						// Update price if provided in the query
						price = parseInt(queryElements.price, 10);

						// Get the sold seats from query parameters
						const soldSeatsRaw = queryElements.seats_sold || '';
							const soldSeats = soldSeatsRaw
								.replace(/[{}%27]/g, '') // Remove curly braces and %27
								.split(',') // Split by commas
								.map(seat => seat.trim()); // Trim whitespace from each seat

					$(document).ready(function () {
						var $cart = $('#selected-seats'), //Sitting Area
							$counter = $('#counter'), //Votes
							$total = $('#total'); //Total money

						function getRowLetter(rowNumber) {
							return String.fromCharCode(65 + rowNumber)
						}


						var sc = $('#seat-map').seatCharts({
							map: [ //Seating chart
								'aaaaaaaaaa',
								'aaaaaaaaaa',
								'__________',
								'_aaaaaaaa_',
								'aaaaaaaaaa',
								'aaaaaaaaaa',
								'aaaaaaaaaa',
								'aaaaaaaaaa',
								'aaaaaaaaaa',
								'aaaaaaaaaa'
							],
							naming: {
								top: false,
								columns: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10'],
								rows: ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I','J'],
								getLabel: function (character, row, column) {
									return column;
								}
							},
							legend: { //Definition legend
								node: $('#legend'),
								items: [
									['a', 'available', 'Available'],
									['a', 'unavailable', 'Sold'],
									['a', 'selected', 'Selected']
								]
							},
							// seats: {
							// 	a: {
							// 		classes: 'vip',
							// 		price: VIP_price,
							// 		category: 'VIP Seats'
							// 	},
							// 	b: {
							// 		classes: 'economy',
							// 		price: org_price,
							// 		category: 'normal seats'
							// 	}
							// },


							click: function () { //Click event
								if (this.status() == 'available') { //optional seat
									var rowLetter = getRowLetter(this.settings.row);
									$('<li>R-' + (rowLetter) + '	S-' + this.settings.column + '</li>')
										.attr('id', 'cart-item-' + this.settings.id)
										.data('seatId', this.settings.id)
										.appendTo($cart);

									// var price = this.data().price,
									// 	category = this.data().category;

									$counter.text(sc.find('selected').length + 1);
									$total.text(recalculateTotal(sc) + price);

									return 'selected';
								} else if (this.status() == 'selected') { //Checked
									//Update Number
									$counter.text(sc.find('selected').length - 1);
									//update totalnum
									$total.text(recalculateTotal(sc) - price);

									//Delete reservation
									$('#cart-item-' + this.settings.id).remove();
									//optional
									return 'available';
								} else if (this.status() == 'unavailable') { //sold
									return 'unavailable';
								} else {
									return this.style();
								}
							}
						});
						//sold seat
						sc.get(soldSeats).status('unavailable');

					});
					//sum total money
					function recalculateTotal(sc) {
						var total = 0;
						sc.find('selected').each(function () {
							total += price;
						});

						return total;
					}
				</script>
			</div>
		</div>

		<input type="button" name="next-step" class="next-step" value="Proceed to Payment" />

		<script type="text/javascript" src="js/theme-change-seat-sel.js"></script>
		<script src="js/jquery.nicescroll.js"></script>
		<script src="js/scripts.js"></script>
</body>

</html>